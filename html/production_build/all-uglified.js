function pop_up(a,b){if(!window.focus)return!0;var c="string"==typeof a?a:a.href;return window.open(c,b,"width=800,height=800,toolbar=no, scrollbars=yes"),!1}function extend(a,b){return Object.keys(b).forEach(function(c){a[c]=b[c]}),a}function checkApiKey(){var a=localStorage.getItem("apiKey");return console.log("function - get apiKey from STORAGE: "+a),a}function isItemNullorUndefined(a){return cc("isItemNullorUndefined: "+a,"run"),null==a||"null"==a||void 0==a||"undefined"==a?(cc("ITEM is - "+a,"error"),!0):!1}function you_must_login(){alert("Please Log In.")}function cheatModeToggle(){$(".cheatmode").toggle()}function startSession(){cc("startSession","run"),setSessionID(),setDefaultData()}function clearSession(){cc("clearSession","run"),localStorage.setItem("session_id",""),localStorage.setItem("start_date",""),localStorage.setItem("end_date",""),localStorage.setItem("apiKey","")}function getStoredSessionData(a){cc("getStoredSessionData("+a+")","run");var b=localStorage.getItem(a);return b}function saveLastAction(a){localStorage.setItem("last_action",a)}function setSessionID(){var a=Math.random().toString(36).substr(2,7);localStorage.setItem("session_id",a),console.log("session_id set: "+a)}function setDefaultData(){cc("setDefaultData","run"),localStorage.setItem("students",null),localStorage.setItem("quizzes",null),localStorage.setItem("courses",null),localStorage.setItem("all_students",null)}function setStartDate(){cc("setStartDate","run");var a=$("#start_date").val();isItemNullorUndefined(a)&&(a="2015-01-01"),localStorage.setItem("start_date",a),cc("start_date set: "+a,"info")}function setEndDate(){cc("setEndDate","run");var a=$("#end_date").val();isItemNullorUndefined(a)&&(a="2015-12-31"),localStorage.setItem("end_date",a),cc("end_date set: "+a,"info")}function setMetricType(a){localStorage.setItem("metric_type",a),cc("metric_type set: "+a,"info")}function setAppMetricSpecific(a){localStorage.setItem("app_metric_specific",a),cc("app_metric_specific set: "+a,"info")}function setEventMetricSpecific(a){localStorage.setItem("event_metric_specific",a),cc("event_metric_specific set: "+a,"info")}function setApiKey(a){localStorage.setItem("apiKey",a),cc("apiKey set: "+a,"info")}function checkUserSessionID(){var a=localStorage.getItem("session_id");return isItemNullorUndefined(a)&&(a="999999999_session_id_default",cc("No session_id is set so the default of "+a+" will be used"),setSessionID(a)),a}function checkStartDate(){var a=localStorage.getItem("start_date");return isItemNullorUndefined(a)&&(a="2015-01-01",cc("No Start Date is set so the default date of "+a+" will be used"),setStartDate(a)),a}function checkEndDate(){var a=localStorage.getItem("end_date");return isItemNullorUndefined(a)&&(a="2015-12-31",cc("No end_date is set so the default of "+a+" will be used"),setEndDate(a)),a}function checkMetricType(){var a=localStorage.getItem("metric_type");return isItemNullorUndefined(a)&&(a="appMetrics",cc("No metric_type is set so the default of "+a+" will be used"),setMetricType(a)),a}function checkAppMetricSpecific(){var a=localStorage.getItem("app_metric_specific");return isItemNullorUndefined(a)&&(a="NewUsers",cc("No app_metric_specific is set so the default of "+a+" will be used"),setAppMetricSpecific(a)),a}function checkEventMetricSpecific(){var a=localStorage.getItem("event_metric_specific");return isItemNullorUndefined(a)&&(a="CourseViewed",cc("No event_metric_specific is set so the default of "+a+" will be used"),setEventMetricSpecific(a)),a}function checkStorageItem(a){var b=localStorage.getItem(a);return cc("Check STORAGE Item "+a,"info"),b}function checkApiKey(){cc("checkApiKey","run");var a=localStorage.getItem("apiKey");if(isItemNullorUndefined(a)){cc("No apiKey is set so check URL for parameter","warning");var b=urlParams.apiKey;isItemNullorUndefined(b)?cc("No apiKey is found in the URL. Queries will not find data.","fatal"):(setApiKey(b),a=b)}return a}function find_most_popular_courses(){console.log(" #### most_popular_courses ####");var a=[],b=$("#plan_filter").find(":selected").data("id");b=parseInt(b),console.log("plan_filter_id: "+b);var a=[{planID:"99",courseID:"30"},{planID:"00",courseID:"29"},{planID:"00",courseID:"31"},{planID:"99",courseID:"32"}];console.log(a),console.log("end plan_courses_data");var c=_.pluck(a,"courseID"),d=_.uniq(c);console.log(d),console.log("end unique_courseIDs"),d.sort(function(a,b){return a-b}),console.log(d),console.log("end SORTED unique_courseIDs"),jQuery.each(a,function(a,c){var d=parseInt(c.planID);(b=d)&&plan_ids_matched.push(c)}),console.log(plan_ids_matched),console.log("plan_ids_matched end"),jQuery.each(plan_ids_matched,function(a,b){var c=parseInt(b.courseID),d=base_url+"course/overview/"+c;$.getJSON(d,function(a){console.log("getting INTERNAL url_overview_data:"+d),console.log(a),course_ids_matched.push(a),console.log("course_ids_matched ADDED INNER"),console.log(course_ids_matched);var b=_.sortBy(course_ids_matched,"Viewed"),c=b.reverse();console.log("reversed_sorted_course_overview_data ^^^^^^^^^^^^-"),console.log(c)})})}function show_most_popular_courses(){find_most_popular_courses(),console.log(course_ids_matched),console.log("course_ids_matched OUTER")}function populate_data_content(){console.log("DO: populate_data_content()");var a=30,b=base_url+"course/duration/"+a,c=base_url+"course/graph/"+a,d=base_url+"coursemodule/courseduration/"+a+"/",e=base_url+"knowledgecheck/student/",f=base_url+"knowledgecheck/response/",g=base_url+"course/lastupdate/"+a;$.getJSON(g,function(a){console.log("******* getting lastupdate_json data *********"),console.log(a),console.log(a["LAST UPDATED"]),console.log(a["NEWEST RECORD"]);var b=a["LAST UPDATED"];b=moment(a["LAST UPDATED"]).format("MM/DD/YYYY, h:mm:ss a"),$("#overview_updated_date").html(b);var c=a["NEWEST RECORD"];c=moment(a["NEWEST RECORD"]).format("MM/DD/YYYY, h:mm:ss a"),$("#overview_updated_usage").html(c)}),$.getJSON(b,function(a){console.log("summary learner data:"),console.log(a);var b=$("#learnerdetails");b.empty(),jQuery.each(a,function(a,c){var g="",h="",i="",j=$.getJSON(d+c.ACTOR),k=$.getJSON(e+c.ACTOR),l=$.getJSON(f+c.ACTOR);console.log("========================== GETTING LEARNER DETAILS FOR ACTOR: "+c.ACTOR+"=========================");var m=c.ACTOR.replace(/[^a-zA-Z 0-9]+/g,"");$.when(j,k,l).done(function(a,b,c){md=$.parseJSON(a[2].responseText),jQuery.each(md,function(a,b){g+="<li>"+b.Duration+": "+b.name+"</li>"}),kd=$.parseJSON(b[2].responseText),jQuery.each(kd,function(a,b){thistarget=unescape(b.TARGET),tmparray=thistarget.split("/"),targetname=$(tmparray).get(-2),h+="<li>"+targetname+": "+b.ACTIVITY+"</li>"}),rd=JSON.parse(c[2].responseText),console.log("responses raw data: "),console.log(rd[1]),console.log("response element: "),jQuery.each(rd,function(a,b){console.log(b.RESPONSE),rdresponse=b.RESPONSE.split(";"),jQuery.each(rdresponse,function(a,b){i+="<li>"+b+"</li>"})}),mtmp="#"+m+" .mdata ul.m",ktmp="#"+m+" .kdata ul.k",rtmp="#"+m+" .kdata ul.r",mico="#"+m+" .mdata i",kico="#"+m+" .kdata i",""!=g&&$(mico).removeClass("red").addClass("green"),""!=h&&$(kico).removeClass("red fa-minus-square-o").addClass("fa-check-square-o green"),$(mtmp).append(g),$(ktmp).append(h),$(rtmp).append(i)}),b.append('<tr class="expand" id="'+m+'"><td>'+c.NAME+'</td><td class="tdata">'+moment(c.Enter).format("MM/DD/YYYY")+"<br><span>"+moment(c.Enter).format("h:mm:ss a")+'</span></td><td class="mdata"><i class="fa fa-puzzle-piece red"></i><ul class="m">'+g+'</ul></td><td class="kdata"><i class="fa fa-minus-square-o red"></i><div><h5>Knowledge Checks:</h5><ul class="k">'+h+'</ul><div><h5>Responses:</h5><ul class="r">'+i+"</ul></div></td><td>"+c.Duration+"</td></tr>")}),b.trigger("update")}),$.getJSON(url_activityfeed,function(a){var b=$(".verbtable");b.empty();var c=_.uniq(_.pluck(a,"VERB")),d=[];jQuery.each(c,function(a,b){tmp=b.split("/"),tmp='<span class="light label">'+tmp.slice(-1)[0]+"</span>",d.push(tmp)}),d=_.uniq(d),$("#verbsheader").append(d),jQuery.each(a,function(a,c){act=c.VERB,act=act.split("/"),act=act.slice(-1)[0],b.append("<tr><td>"+c.ID+'</td><td style="white-space:nowrap">'+c.NAME+'</td><td style="white-space:nowrap">'+moment(c.SOURCE_TIMESTAMP).format("MM/DD/YYYY")+'</td><td style="white-space:nowrap">'+moment(c.SOURCE_TIMESTAMP).format("h:mm A")+'</td><td style="white-space:nowrap">'+act+"</td><td>"+decodeURI(c.ACTIVITY)+"</td></tr>")}),b.trigger("update")});var h=[],i=[];$.getJSON(c,function(a){console.log("getting chart data..."),console.log(a),$.each(a,function(a,b){console.log(a,b),h.push(a),i.push(b)}),console.log(h),console.log(i);{var b=document.getElementById("updating-chart"),c=b.getContext("2d"),d={labels:h,datasets:[{fillColor:"#fe5f55",strokeColor:"#fe5f55",pointColor:"rgba(220,220,220,1)",pointStrokeColor:"#fff",data:i}]};d.labels[6],new Chart(c).Line(d,{animationSteps:15})}});var j=base_url+"course/overview/"+a;$.getJSON(j,function(a){console.log("getting url_overview_data data..."),console.log(a),console.log(a.Experienced),console.log(a.Viewed),console.log(a.Mastery),$("#overview_viewed").html(a.Viewed),$("#overview_experienced").html(a.Experienced),$("#overview_mastery").html(a.Mastery)});var k=base_url+"course/lastupdate/"+a;$.getJSON(k,function(a){console.log("getting overview_updated_url data..."),console.log(a),console.log(a.LASTUPDATED),console.log(a.NEWESTRECORD),$("#overview_updated_date").html(moment(a.LASTUPDATED).format("MMMM Do YYYY, h:m a")),$("#overview_updated_usage").html(moment(a.NEWESTRECORD).format("MMMM Do YYYY, h:m a"))});var l=base_url+"course/duration/"+a;console.log("video_view_duration_url: "+l);var m=[],n=[],o=null,p=null,q=0;$.getJSON(l,function(a){var b=_.pluck(a,"ACTOR");console.log("ALL ACTORS ---------------"),console.log(b);var c=_.uniq(b);console.log("unique_actors ---------------"),console.log(c);var d=_.size(c);console.log("UNIUE USERS ---------------"+d),$("#total_unique_users").html(d);var e=_.pluck(a,"Duration");$.each(e,function(a,b){m.push(a),n.push(a);var c=moment.duration(b,"HH:mm:ss").asSeconds();c=Math.round(c),console.log("value_seconds:"+c),m.push(c),parseFloat(c,2)>5&&parseFloat(c,2)<7201&&parseFloat(c,2)>0&&(n.push(c),p++),q+=c,o++}),n=_.compact(n),console.log("oooooooo view_duration_seconds_clean_data ooooooooo"),console.log(n),console.log("view_total_launches_clean_data:"+p);var f=o-p;console.log("****** total_abandoned_or_stalled:"+f),$("#total_abandoned_or_stalled").html(f),console.log("view_total_launches = "+o),$("#view_total_launches").html(o);var g=_.max(n);g/=60,g=Math.round(g),console.log("longest_view_in_module (mins): "+g),$("#longest_view_in_module").html(g);var h=_.min(n);console.log("shortest_view_in_module (secs): "+h),$("#shortest_view_in_module").html(h);var i=q/o;console.log("average_viewing_length_in_module (sec): "+i),i/=60,i=Math.round(i),console.log("average_viewing_length_in_module rounded (mins): "+i),$("#average_viewing_length_in_module").html(i),console.log("##### END view_duration_seconds #######");{var j={labels:["Usage Overview"],datasets:[{label:"Usage Overview",fillColor:"#FFEA88",data:[o]},{label:"Usage Overview",fillColor:"#4ACAB4",data:[f]},{label:"Usage Overview",fillColor:"#FF8153",data:[d]}]},k=document.getElementById("video_views_bar").getContext("2d"),l=(new Chart(k).Bar(j),document.getElementById("video_view_duration")),r=l.getContext("2d"),s={segmentShowStroke:!0,segmentStrokeColor:"#eee",segmentStrokeWidth:2,percentageInnerCutout:50,animationSteps:100,animationEasing:"easeOut",animateRotate:!0,animateScale:!0},t=[{value:h,color:"#878BB6"},{value:g,color:"#4ACAB4"},{value:i,color:"#fdd687"}];new Chart(r).Doughnut(t,s)}})}$(document).ready(function(){console.error(),console.warn(),console.log("%c Document Ready","background: #00cc00; color: #000; padding: 2px 300px")}),function(){function a(a){for(var b=this.length;b;){var c=this[--b];this[b]=[].concat(a.call(c,c,b),c)}this.sort(function(a,b){for(var c=0,d=a.length;d>c;++c)if(a[c]!=b[c])return a[c]<b[c]?-1:1;return 0});for(var b=this.length;b;)this[--b]=this[b][this[b].length-1];return this}if("function"==typeof Object.defineProperty)try{Object.defineProperty(Array.prototype,"sortBy",{value:a})}catch(b){}Array.prototype.sortBy||(Array.prototype.sortBy=a)}();var urlParams;(window.onpopstate=function(){var a,b=/\+/g,c=/([^&=]+)=?([^&]*)/g,d=function(a){return decodeURIComponent(a.replace(b," "))},e=window.location.search.substring(1);for(urlParams={};a=c.exec(e);)urlParams[d(a[1])]=d(a[2])})(),console.log("*************** urlParams ************"),console.log(urlParams),console.log("apiKey from URL: "+urlParams.apiKey);var this_page_apiKey=urlParams.apiKey;localStorage.setItem("apiKey",this_page_apiKey),$(".accordion-tabs-minimal").each(function(){$(this).children("li").first().children("a").addClass("is-active").next().addClass("is-open").show()}),$(".accordion-tabs-minimal").on("click","li > a.tab-link",function(a){if($(this).hasClass("is-active"))a.preventDefault();else{a.preventDefault();var b=$(this).closest(".accordion-tabs-minimal");b.find(".is-open").removeClass("is-open").hide(),$(this).next().toggleClass("is-open").toggle(),b.find(".is-active").removeClass("is-active"),$(this).addClass("is-active")}}),$(function(){$("#start_date").datepicker({defaultDate:"+1w",changeMonth:!0,numberOfMonths:3,onClose:function(a){$("#end_date").datepicker("option","minDate",a),localStorage.setItem("start_date",a),console.log("NEW start_date: "+a)}}),$("#end_date").datepicker({formatDate:"yyyy-mm-dd",changeMonth:!0,numberOfMonths:3,onClose:function(a){$("#start_date").datepicker("option","maxDate",a),localStorage.setItem("end_date",a),console.log("NEW end_date: "+a)}})}),$.datepicker.setDefaults({dateFormat:"yy-mm-dd"}),FpJsFormValidator.config={routing:{check_unique_entity:null}},$(document).ready(function(){function getCourses(a){curriculumfieldarray.curriculumcoursesfield.find("option").remove(),$.ajax({url:url_course_list,type:"GET",success:function(b){$.each(b,function(a,b){curriculumfieldarray.curriculumcoursesfield.append('<option value="'+b.ID+'">'+b.name+"</option>")}),getPlanCourses(a)}})}function getPlanCourses(a){var b=$("#objformcontainer #activecourses");b.find("li").remove(),$.ajax({url:url_curriculum_list_courses+a,type:"GET",success:function(a){$.each(a,function(a,c){$("#objformcontainer #availcourses option").each(function(){this.value==c.courseID&&($(this).attr("selected","selected"),$(this).hide(),b.append('<li><a href="#" class="primary badge" data-courseplanid="'+c.ID+'" data-id="'+c.courseID+'"><i class="icon-cancel-circled"></i> '+c.name+"</a></li>"))})})}})}function getObjectData(otype){dna.empty("obj-list",{fade:!0}),showLoader(),$.getJSON(eval("url_"+otype+"_list"),function(a){0!==a.length&&($.each(a,function(a,b){dna.clone("obj-list",b,{html:!0,fade:!0})}),hideLoader())})}function jsonSerialize(a){var b=$(a).serializeArray();console.log(b);var c={};return $.each(b,function(){""==objidfield.val()&&"courses"==this.name&&(this.value=arraycourses),c[this.name]=this.value||""}),console.log(c),c}function showLoader(){loader.fadeIn()}function hideLoader(){loader.fadeOut()}var base_url=urls.analytics,reports_base_url=urls.reports;cc("analytics base_url: "+base_url,"info"),cc("reports base_url: "+reports_base_url,"info");var user_roles=user.roles,url_activelearners=base_url+"activelearners",url_challenges=base_url+"challenges",url_remediations=base_url+"remediations",url_alerts=base_url+"alerts",url_openalerts=base_url+"openalerts",url_activitygraph=base_url+"activitygraph",url_usergraph=base_url+"usergraph",url_messagegraph=base_url+"messagegraph",url_plan=base_url+"plan",url_activityfeed=base_url+"statement",url_verbtrends=base_url+"verbtrends",url_usertrends=base_url+"actortrends",url_activitytrends=base_url+"targettrends",url_quiz_reports=base_url+"results",url_course_students=base_url+"results/courselist/",actor=user.email,mode=$("#analytics_mode").html(),pcid=$("#pageid").html(),base_url=urls.settings,loader=$(".loading"),empty=$(".empty"),objformcontainer=$("#objformcontainer"),objform=$("#object-form"),objidfield=$("#objformcontainer #id"),url_lrs_list=base_url+"lrs/",url_lrs_view=base_url+"lrs/",url_lrs_post=base_url+"lrs/",url_lrs_update=base_url+"lrs/",url_lrs_delete=base_url+"lrs/remove/",lrsfieldarray={lrsnamefield:$("#objformcontainer #name"),lrsurifield:$("#objformcontainer #uri"),lrsusernamefield:$("#objformcontainer #username"),lrspasswordfield:$("#objformcontainer #password"),lrsoauthfield:$("#objformcontainer #oAuth"),lrsdescriptionfield:$("#objformcontainer #description"),lrscontactfield:$("#objformcontainer #contact"),lrscreatedbyfield:$("#objformcontainer #createdBy")},url_course_list=base_url+"course/",url_course_view=base_url+"course/",url_course_post=base_url+"course/",url_course_update=base_url+"course/",url_course_delete=base_url+"course/remove/",coursefieldarray={coursenamefield:$("#objformcontainer #name"),courseurlfield:$("#objformcontainer #URL"),coursedescriptionfield:$("#objformcontainer #description"),coursecreatedbyfield:$("#objformcontainer #createdBy")},url_curriculum_list=base_url+"plan/",url_curriculum_list_courses=base_url+"courseplan/",url_curriculum_view=base_url+"plan/",url_curriculum_post=base_url+"plan/",url_curriculum_update=base_url+"plan/",url_curriculum_delete=base_url+"plan/remove/",arraycourses=[],curriculumfieldarray={curriculumnamefield:$("#objformcontainer #name"),curriculumdescriptionfield:$("#objformcontainer #description"),curriculumcreatedbyfield:$("#objformcontainer #createdBy"),curriculumcoursesfield:$("#objformcontainer #availcourses"),curriculumtypefield:$("#objformcontainer #type")},url_courseplan_delete=base_url+"courseplan/remove/";if($("#widget-object").length){var objtype=$("#widget-object").attr("data-type");console.log("object type:"+objtype),getObjectData(objtype)}$("body").on("click",".add-object, .edit-object",function(e){console.log("add/edit object");var objid=$(this).attr("data-id"),objtype=$(this).attr("data-type");objidfield.val(""),objform[0].reset(),"curriculum"==objtype&&getCourses(objid),void 0!==objid?(console.log(objid),$.getJSON(eval("url_"+objtype+"_view")+objid,function(json){console.log(json),0!==json.length&&$.each(json,function(i,val){objidfield.val(val.ID),$.each(eval(objtype+"fieldarray"),function(i,item){if($("#"+item.attr("name")).val(eval("val."+item.attr("name"))),"curriculum"==objtype&&"type"==item.attr("name")){console.log(item.attr("name"));var tmp=eval("val."+item.attr("name"));console.log(tmp),$("#"+item.attr("name")+" option[value='"+tmp+"']").attr("selected","selected")}})})})):objform[0].reset(),objformcontainer.addClass("active")}),objform.submit(function(e){e.preventDefault();var objdata=jsonSerialize($(this)),objtype=$(this).attr("data-type");if(console.log(objdata),""==objidfield.val()){console.log("Posting New Object");var url=eval("url_"+objtype+"_post"),txtype="POST"}else{console.log("Updating Object");var url=eval("url_"+objtype+"_update"),txtype="POST"}$.ajax({url:url,data:objdata,type:txtype,success:function(a){objformcontainer.removeClass("active"),getObjectData(objtype),console.log(a)}})}),$("body").on("click",".delete-object",function(e){e.preventDefault();var objtype=$(this).attr("data-type"),id=$(this).attr("data-id");window.confirm("Deletions cannot be undone. Continue?")&&$.ajax({url:eval("url_"+objtype+"_delete")+id,type:"GET",success:function(){getObjectData(objtype)}})}),$("body").on("click","#objformcontainer #availcourses option",function(){var a=$(this).val(),b=$(this).text(),c=$("#objformcontainer #activecourses");if($(this).hide(),$(this).attr("selected","selected"),c.append('<li><a href="#" class="primary badge" data-id="'+a+'"><i class="icon-cancel-circled"></i> '+b+"</a></li>"),""!==objidfield.val()){var d={planID:objidfield.val(),courses:[a],createdBy:actor};$.ajax({url:url_curriculum_list_courses,type:"POST",data:d,success:function(){}})}else arraycourses.push(a)}),$("body").on("click","#objformcontainer #activecourses li a.badge",function(a){if(a.preventDefault(),confirm("This will remove this course from the current Plan. Proceed?")){var b=$(this).attr("data-id"),c=$(this).attr("data-courseplanid");$('#objformcontainer #availcourses option[value="'+b+'"]').show(),$('#objformcontainer #availcourses option[value="'+b+'"]').removeAttr("selected"),$(this).parent().remove(),""!==c&&$.ajax({url:url_courseplan_delete+c,type:"GET",success:function(a){console.log(a)}})}})}),$("#select-all").on("click",function(a){var b=$(a.target).closest("table");$("td input:checkbox",b).prop("checked",this.checked)}),$(document).ready(function(){$(".tablesorter").tablesorter({headers:{0:{}}}),$(".tablesorter-filter-paged").tablesorter({headers:{0:{}},widgets:["zebra","filter"],widthFixed:!0,widgetOptions:{filter_defaultFilter:{1:"~{query}"},filter_columnFilters:!0,filter_placeholder:{search:"Search..."},filter_saveFilters:!0,filter_reset:".reset"}});new Pikaday({field:$(".datepicker")[0]});$("#filterbox").on("keyup",function(){searchstr=$(this).val().toLowerCase(),filterel=$(".filteritems td.name"),filterel.each(function(){$(this).text().toLowerCase().indexOf(searchstr)<0?$(this).parent().hide():$(this).parent().show()})})});var base_url=urls.messaging;$("body").on("click",function(a){var b=$(a.target);if(!b.hasClass("active")){var c=b.parents(".active");0==c.length&&$("a.active").click()}}),$("#fos_user_profile_form_country").selectBoxIt({autoWidth:!1}),$("#fos_user_profile_form_company").selectBoxIt({autoWidth:!1}),$("#root form ul li.field select").selectBoxIt({autoWidth:!1}),$("#Priority").selectBoxIt({autoWidth:!1}),$("#type").selectBoxIt({autoWidth:!1});var base_url=urls.analytics,url_activityfeed=base_url+"statement",plan_ids_matched=[],course_ids_matched=[];$("#plan_course_filter").on("change",function(){populate_data_content()}),$(document).ready(function(){}),$(document).ready(function(){$(".loading")}),$(document).ready(function(){function a(){return d(),tmpurl="plan"==o?z+p:"courseplan"==o?A+p:"sessionplan"==o?B+p:"actorplan"==o?C+p:y,console.log("checking this:"+tmpurl),tmpurl}function b(a){console.log("getting attachments...");var b=(new Array,F+a);$.ajax({url:b,type:"GET",success:function(a){console.log(a),jQuery.each(a,function(a,b){attach_url=G+b.AttachmentID,console.log("loading: "+attach_url);$.ajax({url:attach_url,type:"GET",autoSubmit:!1,xhrFields:{withCredentials:!0},beforeSend:function(a){a.setRequestHeader("Authorization","Basic "+btoa(J+":"+K))},crossDomain:!0,success:function(a){var c=a.filename,d=a.mimetype.split("/"),e=Math.round(a.filesize/1048576*100)/100,f="mb";1>e&&(e=Math.round(a.filesize/1024*100)/100,f="kb"),console.log(d[1]);var h=g(d[1]),i='<li><a href="/app_dev.php/messages/attachment/'+b.AttachmentID+'" class="ttip switch" data-tooltip="'+c+" | "+e+" "+f+'"><i class="fa fa-file-'+h+'o fa-2x"></i></a></li>';$(".message-attachments").append(i),console.log(i)}})})}})}function c(a){console.log("getting attachments...");var b=(new Array,F+a),c=!1;return $.ajax({url:b,type:"GET",success:function(a){console.log(a),jQuery.each(a,function(a,b){attach_url=H+"/"+b.AttachmentID,console.log("deleting: "+attach_url);$.ajax({url:attach_url,type:"DELETE",autoSubmit:!1,xhrFields:{withCredentials:!0},beforeSend:function(a){a.setRequestHeader("Authorization","Basic "+btoa(J+":"+K))},crossDomain:!0,success:function(a){console.log(a.status),c=a.status},error:function(a){console.log(a.status)}})})}}),c}function d(){o=n("filter_mode"),p="plan"==o?n("current_plan"):"courseplan"==o?n("current_course"):"sessionplan"==o?n("current_session"):"actorplan"==o?n("current_actor"):""}function e(a){var b=$(a),c=b.find("input[name='To']").val(),d=q,e=b.find("input[name='Subject']").val(),f=b.find("textarea[name='Message']").val(),g=$("#Priority option:selected").text(),h={To:c,From:d,Subject:e,Message:f,Type:"Message",Priority:g,Attachment:O};console.log(h);$.post(v,h,function(a){console.log(a),window.location="/app_dev.php/messages/home"}).fail(function(){alert("Your message was not sent due to an undisclosed error. Please check your recipient email address to ensure it's valid and try again.")})}function f(a){console.log("checking mail...");var b=!1;l(),dna.empty("messages-body",{fade:!0}),h(),$.getJSON(a,function(a){0!==a.length?jQuery.each(a,function(a,c){"0"==c.Read?(c.Read="unread",-1===$.inArray(c.ID,N)&&(b=!0,N.push(c.ID))):c.Read="read",c.Priority='<span class="'+P[c.Priority]+' badge"><i class="icon-'+Q[c.Priority]+'"></i></span>',$.ajax({url:I+c.From,type:"GET",success:function(a){c.Senderphoto='<img src="'+a+'">',dna.clone("messages-body",c,{html:!0,fade:!0}),$("#sortable").trigger("update");var b=[[3,1]];$("#sortable").trigger("sorton",[b])}})}):k()}),j()}function g(a){return void 0!==R[a]?R[a]+"-":""}function h(){L.fadeIn()}function j(){L.fadeOut()}function k(){M.fadeIn()}function l(){M.fadeOut()}function m(a){var b,c=a.length,d=72,e="";if(a=a.replace("<p>",""),a=a.replace("</p>",""),c>d)for(i=0;i<c;i+=d)e+="&gt; "+a.substr(i,d)+"<br>";else e="&gt; "+a+"<br>";return b=e}function n(a){var b=JSON.parse(localStorage.getItem(a));return null===b?"":b}var o,p,q=user.email;d();{var r=urls.messaging,s=urls.attachment,t=message.id,u=r+"message/"+t,v=r+"message/",w=r+"reply/",x=r+"message/remove/",y=r+"message/actor/"+q,z=r+"message/plan/",A=r+"message/course/",B=r+"message/session/",C=r+"message/actor/",D=r+"notification/actor/"+q,E=r+"message/sender/"+q,F=r+"message/attachments/",G=s+"metadata/",H=s+"attachment",I="/app_dev.php/messages/actorphoto/",J="lumious",K="0zdkkINkN8y5qmOS",L=$(".loading"),M=$(".empty"),N=new Array,O=new Array,P={Low:"default",Normal:"primary",High:"danger"},Q={Low:"down",Normal:"mail",High:"attention"},R={jpeg:"image",jpg:"image",png:"image",gif:"image",tiff:"image",tif:"image",bmp:"image",pdf:"pdf",zip:"zip",csv:"excel",word:"word",mpeg:"audio",mp3:"audio",quicktime:"video",mp4:"video"},S=$(".chalrem-form");$(".chalrem-form #PlanID")}if(S.each(function(){var a=$(this).attr("data-type"),b=r+a+"plan/",c=$(this);$.ajax({url:b,type:"GET",success:function(a){console.log(a),$.each(a,function(a,b){thismenu=$(c).find("#PlanID"),thismenu.append('<option value="'+b.ID+'">'+b.name+"</option>")})}})}),$("#messages-inbox #messages-body").length){tmpurl=a(),f(tmpurl);{setInterval(function(){f(tmpurl)},6e4)}}$("#messages-sent #messages-body").length&&(tmpurl=a(),f(E)),$("#messages-note #messages-body").length&&(tmpurl=a(),f(D)),$("#messages-inbox .refresh-inbox").on("click",function(b){b.preventDefault(),tmpurl=a(),f(tmpurl)}),$("#widget-message-detail").length&&$.getJSON(u,function(a){var c="",d=$("#message-reply-text"),e=$("#reply-to"),f=$("#reply-subject"),g=$("#reply-id"),h=$("#attachments");console.log(a),jQuery.each(a,function(a,i){"0"!=i.Attachment?(console.log("checking attachments..."),h.show(),b(i.ID)):(console.log("not checking attachments..."),h.hide()),c="<br><br><strong>On "+i.Time_Initiated+", "+i.From+" wrote:</strong><br>",$.ajax({url:I+i.From,type:"GET",success:function(a){i.Senderphoto='<img src="'+a+'">',dna.clone("widget-message-detail",i,{html:!0,fade:!0})}}),c+=m(i.Message),d.val(c),e.val(i.From),f.val("Re: "+i.Subject),g.val(i.ID)})}),$("#message-form").on("submit",function(a){a.preventDefault();var b=$("#fileupload").fileupload("active");console.log("total current uploads: "+b);var c=$(this);b>0?$("#fileupload").bind("fileuploadstop",function(){console.log("uploads done...."),console.log(O),e(c)}):(console.log("no uploads in process"),e(c))}),$("#reply-form").on("submit",function(a){a.preventDefault();{var b=$(this),c=b.find("input[name='MessageID']").val(),d=b.find("input[name='To']").val(),e=q,f=b.find("input[name='Subject']").val(),g=b.find("textarea[name='Message']").val(),h=$("#Priority option:selected").text(),i={MessageID:c,To:d,From:e,Subject:f,Message:g,Type:"Message",Priority:h};$.post(w,i,function(){window.location="/app_dev.php/messages/home"}).fail(function(){alert("Your message was not sent due to an undisclosed error. Please check your recipient email address to ensure it's valid and try again.")})}}),$("#messaging-form").on("submit",function(a){a.preventDefault();{var b=$(this),c=$(this).attr("class"),d=r+c+"/",e=q,f=b.find("input[name='Subject']").val(),g=b.find("textarea[name='Message']").val(),h={From:e,Subject:f,Message:g};$.post(d,h,function(){$("#messaging-form").trigger("reset");for(instance in CKEDITOR.instances)CKEDITOR.instances[instance].setData(" ");alert("Your was successfully sent. You will receive a response soon.")}).fail(function(){alert("Your request was not sent due to an undisclosed error. Please check your recipient email address to ensure it's valid and try again.")})}}),$(".chalrem-form").on("submit",function(a){a.preventDefault();{var b=$(this),c=$(this).attr("data-type"),d=r+c+"/",e=q,f=b.find("input[name='Subject']").val(),g=b.find("textarea[name='Message']").val(),h=b.find("input[name='To']").val(),i=b.find("#PlanID").val(),j={To:h,From:e,Subject:f,Message:g,PlanID:i,SendMail:1};$.post(d,j,function(){$(".chalrem-form").trigger("reset");for(instance in CKEDITOR.instances)CKEDITOR.instances[instance].setData(" ");b.parent().parent().removeClass("active"),alert("Your "+c+" was successfully sent.")}).fail(function(){alert("Your request was not sent due to an undisclosed error. Please check your recipient email address to ensure it's valid and try again.")})}}),$("body").on("click",".message-delete",function(a){$.support.cors=!0,a.preventDefault();var b=$(this).attr("data-id");if(window.confirm("Are you sure you want to delete this message? Deletions cannot be undone. Proceed?")){var d=c(b);console.log(d),console.log("okay"==d?"attachments deleted":"attachments NOT deleted"),$.ajax({url:x+b,type:"GET",success:function(){url=$("body").hasClass("sent")?E:y,f(url)}})}}),window.mailPrep=a,window.setVarsFromLocalStorage=d,window.checkMail=f,$("#fileupload").fileupload({url:H,dataType:"json",autoSubmit:!1,xhrFields:{withCredentials:!0},beforeSend:function(a){a.setRequestHeader("Authorization","Basic "+btoa(J+":"+K))},crossDomain:!0,submit:function(a,b){$.each(b.files,function(a,c){console.log("Added file: "+c.size),b.url=H+"?filename="+c.name+"&mimetype="+c.type+"&filesize="+c.size})},done:function(a,b){console.log(b.files.file),O.push(b.result.id),$.each(b.files,function(a,b){$("<p/>").html('<i class="icon-check"></i>'+b.name).appendTo("#files")})},progressall:function(a,b){var c=parseInt(b.loaded/b.total*100,10);$("#progress .progress-bar").css("width",c+"%")},error:function(a,b,c){console.log(a.responseText),console.log(b),console.log(c)}}).prop("disabled",!$.support.fileInput).parent().addClass($.support.fileInput?void 0:"disabled")});